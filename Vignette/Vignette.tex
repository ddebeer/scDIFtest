\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{Sweave}
\usepackage{apacite}
\parskip 1.5ex % paragraph spacing
%\renewcommand{\baselinestretch}{1.33} % line spacing
\usepackage[left=3.5cm,right=3.5cm,top=3.5cm,bottom=3.5cm]{geometry}
\usepackage{authblk}

\title{Item-Wise DIF Detection Using ScDIFtest: \\
An Illustration With the SPISA data}
\author[1, 2]{Dries Debeer}
\author[2]{Valentina Tomasulo}
\affil[1]{ITEC, imec research group at KULeuven}
\affil[2]{Univeristy of Zurich}
\date{}                     %% if you don't need date to appear
\setcounter{Maxaffil}{0}
\renewcommand\Affilfont{\itshape\small}

\begin{document}


\maketitle

\begin{abstract}
This vignette, explains the installation of the {\tt scDIFtest} package and provides an illustration of item-wise DIF-detection with the {\tt scDIFtest}-function using a subset of the SPISA data set.
\end{abstract}


The score-based test framework for parameter instability has been proposed for testing measurement invariance in measurement models. Until now, the focus was on (a) testing the invariance of all parameters simultaniously, or (b) on testing the invariance of a single parameter in the model. However in educational and psychological assessments, the appropriatness of each items is of interest. For instance, the detection of differential item function (DIF) plays an important role in validating new items. The {\tt scDIFtest} package provides a user-friendly method for detecting DIF by automatically and efficiently applying the tests from the score-based test framework to the individual items in the assessment. The main function of the {\tt scDIFtest} package is the {\tt scDIFtest} function, which is a wrapper around the {\tt strucchange::sctest}-function. 


To detect DIF with the {\tt scDIFtest} package, first, the appropriate Item Response Theory (IRT) or Factor Analysis (FA) model should fitted using the {\tt mirt} package. The {\tt scDIFtest}-function can directly be used on the resulting {\tt mirt}-object. Hence, in addition to the {\tt scDIFtest}, the package {\tt mirt} will typically also be loaded in the {\tt R} session. For now, {\tt scDIFtest} only works for IRT/FA models that were fitted using the {\tt mirt} package, but we aim to extend this to other packages that fit IRT/FA models using maximum likelihood estimation. 



\section*{Overview of the method}

In order to fit the IRT model and analyse DIF with the {\tt scDIFtest}, the following steps are necessary:

\begin{enumerate}
\item installation of the {\tt R}-package(s)
\item data preparation
\item fitting the IRT Model by using either the {\tt mirt} or {\tt multipleGroup} function implemented in the {\tt mirt} package \cite{Chalmers}
\item detecting DIF by using {\tt scDIFtest} \cite{Debeer}
\item interpreting the results
\end{enumerate} 


In the sections that follow, these steps will be explained in detail.



\section{Installation}

The {\tt scDIFtest} package is installed using the following commands:

\begin{Schunk}
\begin{Sinput}
> install.packages("devtools")
> devtools::install_github("ddebeer/scDIFtest")
\end{Sinput}
\end{Schunk}

Since, the {\tt mirt} package \cite{Chalmers} is required for fitting the IRT/FA model of interest, it should also be installed (using {\tt install.packages("mirt")}).


\section{Data preparation}

In this vignette, a subset of the SPISA data is used. This data is part of the {\tt psychotree} package, it can be accessed when the {\tt psychotree} package is installed. To load the SPISA dataset:

\begin{Schunk}
\begin{Sinput}
> install.packages("psychotree", quiet = TRUE)
> data("SPISA", package = "psychotree")
\end{Sinput}
\end{Schunk}



The SPISA data is a subsample from the general knowledge quiz "Studentenpisa" conducted online by the German weekly news magazine SPIEGEL \cite{Spisa}. The data contain the quiz results from 45 questions as well as sociodemographic data for 1075 university students from Bavaria \cite{Spisa}. Although there were 45 questions addressing different topics, this illustration is limited to the analysis of the nine sience questions (items 37 - 45). To analyze the data with {\tt mirt}, the responses are converted to a data frame. 

\begin{Schunk}
\begin{Sinput}
> resp <- as.data.frame(SPISA$spisa[,37:45])
\end{Sinput}
\end{Schunk}

In addition to the responses, the SPSA data also contains five sociodemographic variables (i.e., person covariates): 

\begin{Schunk}
\begin{Sinput}
> summary(SPISA[,2:6])
\end{Sinput}
\begin{Soutput}
    gender         age          semester   elite            spon    
 female:417   Min.   :18.0   2      :173   no :836   never    :303  
 male  :658   1st Qu.:21.0   4      :123   yes:239   <1/month :127  
              Median :23.0   6      :116             1-3/month:107  
              Mean   :23.1   1      :105             1/week   : 79  
              3rd Qu.:25.0   5      : 99             2-3/week : 73  
              Max.   :40.0   3      : 98             4-5/week : 60  
                             (Other):361             daily    :326  
\end{Soutput}
\end{Schunk}


In this illustration, we will try to detect DIF along the following three covariates: 
\begin{itemize}
\item \emph{age} of the student in years (numeric covariate)
\item \emph{gender} of the student (unordered categorical covariate)
\item and \emph{spon}, which is the frequency of assessing the SPIEGEL online (SPON) magazine (ordered categorical covariate)
\end{itemize}



\section{Fitting the IRT model using either the {\tt mirt} or {\tt multipleGroup} function}

It is important to note that, for the package to work, the parameters in the assumed IRT model need to be be estimated using either the {\tt mirt} or the {\tt multipleGroup} function from the {\tt  mirt} package. The {\tt multipleGroup} function can model impact between groups of persons, which is not possible with the {\tt mirt} function. Modeling impact is important when the goal is to detect DIF \cite{DeMars}. In this illustration, for instance, we test whether there is impact with respect to gender by comparing a model which allows ability differences between male and female students with a model that assumes there are no group differencesin ability. The relative fit of these two models is compared, and the best fitting model is selected for the DIF analysis. The general idea is that we want to avoid (a) false DIF detections that can be attributed to ability differences and (b) not detecting DIF that is masked by unmodeled ability differences.

First the {\tt mirt} package is loaded in the {\tt R} session:

\begin{Schunk}
\begin{Sinput}
> library(mirt, quietly = TRUE)
\end{Sinput}
\end{Schunk}

Then the two models are fit and compared. Note that in general we do not recommend using {\tt verbose = FALSE}, but for this vignette it is more convenient.


\begin{Schunk}
\begin{Sinput}
> fit_2PL <- mirt(data = resp, 
                  model = 1, 
                  itemtype = "2PL", 
                  verbose = FALSE)
> fit_multiGroup <- multipleGroup(
    data = resp, model = 1,  
    group = SPISA$gender,
    invariance = c("free_means", 
                   "slopes", 
                   "intercepts", 
                   "free_var"),
    verbose = FALSE)
\end{Sinput}
\end{Schunk}



The comparison of the two models with {\tt anova} yields the following results: 


\begin{Schunk}
\begin{Sinput}
> anova(fit_2PL, fit_multiGroup)                                      
\end{Sinput}
\begin{Soutput}
Model 1: mirt(data = resp, model = 1, itemtype = "2PL", verbose = FALSE)
Model 2: multipleGroup(data = resp, model = 1, group = SPISA$gender, 
    invariance = c("free_means", "slopes", "intercepts", "free_var"), 
    verbose = FALSE)

       AIC     AICc    SABIC       HQ      BIC    logLik     X2  df   p
1 10161.68 10162.33 10194.16 10195.64 10251.33 -5062.843    NaN NaN NaN
2 10139.62 10140.41 10175.69 10177.34 10239.22 -5049.808 26.069   2   0
\end{Soutput}
\end{Schunk}

The {\tt multipleGroup} model with ability differences between male and female test takers best fits the data (lower AIC and BIC; small $p$-value for the Likelihood Ratio Test). It seem like there are differences between male and female stundents with respect to the assessed science knowledge. Therefore, {\tt multipleGroup} model  model is used in the DIF detection analysis. 


\section{Detecting DIF by using scDIFtest}

In the (sub)sections that follow, DIF is tested for three different covariates: gender, age and spon but only the DIF analysis for gender is explained in more detail. Yet the the used {\tt R} commands are the same for any covariate. The interpretation is given for all of the covariates.

\subsection{DIF by {\tt gender}}

To test itemwise DIF along gender, the {\tt scDIFtest} function is used with the fitted model object and {\tt gender} as the {\tt DIF\_covariate} argument. Note that the {\tt scDIFtest} package has to be loaded first.

\begin{Schunk}
\begin{Sinput}
> library(scDIFtest)
> DIF_gender <- scDIFtest(fit_multiGroup, DIF_covariate = SPISA$gender) 
\end{Sinput}
\end{Schunk}
  

The resulting object is assigned to {\tt DIF\_gender}. For a readable version of the results The {\tt print} method is available. In addition, the {\tt summary} method returns a summary of the results as a data frame.

\section{Interpreting the results}

In the two subsections that follow, the results regarding the analyses of itemwise DIF by {\tt gender}, {\tt age} and {\tt spon} will be interpreted.

\subsection{DIF by {\tt gender} }

For the gender covariate, the print method gives the following results: 

\begin{Schunk}
\begin{Sinput}
> DIF_gender
\end{Sinput}
\begin{Soutput}
	Score Based DIF-tests for 9 items
	Person covariate: SPISA$gender
	Test statistic type: Lagrange Multiplier Test for Unordered Groups

   item_type n_est_pars       stat      p_value        p_fdr
V1       2PL          2  0.4141020 8.129782e-01 9.146005e-01
V2       2PL          2  8.3162505 1.563685e-02 4.691054e-02
V3       2PL          2  4.8449033 8.870388e-02 1.995837e-01
V4       2PL          2 32.7335352 7.798358e-08 7.018522e-07
V5       2PL          2  3.2679379 1.951535e-01 3.512763e-01
V6       2PL          2  0.4159221 8.122387e-01 9.146005e-01
V7       2PL          2 30.3499936 2.567927e-07 1.155567e-06
V8       2PL          2  0.1517182 9.269468e-01 9.269468e-01
V9       2PL          2  0.5925442 7.435851e-01 9.146005e-01
\end{Soutput}
\end{Schunk}



First, in three lines some general information is given:

\begin{itemize}
\item the type of test that is performed
\item the covariate along which DIF is tested (in this case {\tt gender} ) and 
\item the test statistic which is used, in this case the Lagrange-Multiplier-Test for unordered covariates, \cite<LMUO; >{Merkle2013, Merkle2014}.
\end{itemize}

After these three lines, a table with the main results is printed with one line for each item that was included in the DIF detection analysis. The columns of the table represent:
\begin{itemize}
\item the name of each item (in this case ``V1'' - ``V9'')
\item {\tt item\_type}: the type of IRT model used for each item (in this case the two-Parameter Logistic Model (2PL))
\item {\tt n\_est\_pars}: the number of estimated parameters for each item
\item {\tt statistic}: the value for the statistic per item (in this case the LMuo statistic)
\item {\tt p-value}: the $p$-value per item
\item {\tt p.fdr}: the False-Discovery-Rate corrected $p$-value \cite{Yoav}
\end{itemize}

The printed output indicates that, when a significance level of $.05$ is used, DIF along {\tt gender} is detected in item V4 and in item V7: these two items function differently, depending on the gender of the students.

When one of more items are selected using the {\tt item\_selection} argument of the {\tt print} method, the underlying {\tt sctest} objects (or M-fluctuation tests) are printed. 

\begin{Schunk}
\begin{Sinput}
> print(DIF_gender, item_selection = c("V4", "V7"))
\end{Sinput}
\begin{Soutput}
	DIF-test for V4
	Person covariate: SPISA$gender
	Test statistic type: Lagrange Multiplier Test for Unordered Groups

	M-fluctuation test

	data:  resp
	f(efp) = 32.734, p-value = 7.798e-08

	DIF-test for V7
	Person covariate: SPISA$gender
	Test statistic type: Lagrange Multiplier Test for Unordered Groups

	M-fluctuation test

	data:  resp
	f(efp) = 30.35, p-value = 2.568e-07
\end{Soutput}
\end{Schunk}

Note that here the uncorrected $p$-values are given.

\subsection{DIF by {\tt age}}
The results for the DIF-detection analysis with {\tt age} as the covariate are:

\begin{Schunk}
\begin{Sinput}
> DIF_age <- scDIFtest(fit_multiGroup, DIF_covariate = SPISA$age)
> DIF_age
\end{Sinput}
\begin{Soutput}
	Score Based DIF-tests for 9 items
	Person covariate: SPISA$age
	Test statistic type: Double Maximum Test

   item_type n_est_pars      stat     p_value      p_fdr
V1       2PL          2 1.0593393 0.378630317 0.56794548
V2       2PL          2 0.7508117 0.859974883 0.96747174
V3       2PL          2 1.3579887 0.097556732 0.21950265
V4       2PL          2 1.6092879 0.022393893 0.06718168
V5       2PL          2 1.0936080 0.332120746 0.56794548
V6       2PL          2 1.6830445 0.013808746 0.06213936
V7       2PL          2 0.5720489 0.989797256 0.98979726
V8       2PL          2 0.7729229 0.830878151 0.96747174
V9       2PL          2 1.9126378 0.002656523 0.02390871
\end{Soutput}
\end{Schunk}



In this case, the Double Maximum Test for continuous numeric orderings \cite<dm;>{Merkle2013, Merkle2014} is used. The results indicate that DIF along {\tt age} is detected in three items: V4 ($p = 0.022$), V6 ($p = 0.014$), and V9 ($ p = 0.003$). Note that the score-based framework has the power to detect DIF along numeric covariates, without assuming some functional form of the DIF.

\subsection{DIF by {\tt spon}}
The results for the DIF-detection analysis with {\tt spon} as the covariate are:

\begin{Schunk}
\begin{Sinput}
> DIF_spon <- scDIFtest(fit_multiGroup, DIF_covariate = SPISA$spon)
> DIF_spon
\end{Sinput}
\begin{Soutput}
	Score Based DIF-tests for 9 items
	Person covariate: SPISA$spon
	Test statistic type: Maximum Lagrange Multiplier Test for Ordered
	Groups

   item_type n_est_pars     stat    p_value     p_fdr
V1       2PL          2 1.868941 0.77948065 0.8769157
V2       2PL          2 6.342694 0.13845728 0.4436186
V3       2PL          2 2.390256 0.66388944 0.8535721
V4       2PL          2 3.597938 0.43203919 0.6480588
V5       2PL          2 7.536444 0.08132661 0.4436186
V6       2PL          2 4.847357 0.26199955 0.5319802
V7       2PL          2 1.304980 0.89486619 0.8948662
V8       2PL          2 6.174822 0.14787287 0.4436186
V9       2PL          2 4.553582 0.29554456 0.5319802
\end{Soutput}
\end{Schunk}


In this case, the maximum Lagrange-Multiplier-Test \cite<maxLMo;>{Merkle2013, Merkle2014} is used. Since all tests result in large $p$-values, we conclude that no DIF was detected along the {\tt spon} covariate.

%\section*{Acknowledgements}
%To be added...?


\bibliographystyle{apacite}
\bibliography{References}


\end{document}
